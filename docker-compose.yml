services:
  manifixer:
    container_name: manifixer
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      INPUT_DIR: /data/input
      OUTPUT_DIR: /data/output
      WATCH_MODE: "1"
      POLL_SECONDS: "30"
      PORT: "8080"
    volumes:
      - ./data/input:/data/input
      - ./data/output:/data/output
    restart: unless-stopped
    healthcheck:
      test:
        - CMD-SHELL
        - python -c "import urllib.request; urllib.request.urlopen('http://localhost:8080/health', timeout=3)"
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 20s